Views.HcVisits.EditEquipmentStatus=Backbone.View.extend({template:JST["offline/templates/hc_visits/edit_equipment_status"],tagName:"div",className:"edit-equipment-status",tabName:"tab-equipment-status",state:"todo",events:{change:"change","click .nr":"nrChange"},initialize:function(a){this.model.get("equipment_status")||this.model.set("equipment_status",{});var b=this;this.model.on("change:visited",function(){b.refreshState();b.trigger("refresh:tabs")});this.model.get("visited")===!1&&(this.state="disabled")},render:function(){this.delegateEvents();this.$el.html(this.template({equipmentStatus:this.model.get("equipment_status")}));this.validate();this.refreshState();return this},close:function(){this.undelegateEvents();this.remove();this.unbind()},nrChange:function(a){var b=a.srcElement,c=this.$("#"+b.id.slice(0,-3));b.checked&&c.val(null);this.change(a,c[0])},numberChange:function(a){var b=a.srcElement,c=this.$("#"+b.id+"-nr");c.attr("checked")&&c.attr("checked",!1);this.change(a,b)},change:function(a,b){b=b||a.srcElement;var c=this.serialize();this.model.set("equipment_status",c.equipment_status);this.validateElement(a,b);this.refreshState()},serialize:function(){return this.$("form").toObject({skipEmpty:!1,emptyToNull:!0})},validate:function(){var a=this;this.$(".validate").each(function(b,c){a.validateElement(null,c)})},validateElement:function(a,b){b=b||a.srcElement;if(!this.$(b).hasClass("validate"))return;var c="#hc_visit-"+b.name.replace(/[.\[\]]+/g,"-").replace(/-$/,"")+"-x";if(this.model.deepGet(b.name)){this.$(c).removeClass("x-invalid").addClass("x-valid");return}this.$(c).removeClass("x-valid").addClass("x-invalid");return"is invalid"},refreshState:function(a){this.state=this.checkState();return this},checkState:function(a){return this.model.get("visited")?this.$(".x-invalid").length==0?"complete":this.$(".x-valid").length==0?"todo":"incomplete":"disabled"}});